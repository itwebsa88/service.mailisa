{% load static %}
<!DOCTYPE html>
<html lang="vi" style="height: 100%">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>ADMIN PANEL</title>
    <link rel="icon" href="https://server.thienduongtop.online/favicon.ico" type="image/ico" />
    <meta name="author" content="yinqi" />

    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" />
    <link href="{% static 'css/style.css' %}" rel="stylesheet" />
    <link href="//cdnjs.cloudflare.com/ajax/libs/layui/2.9.14/css/layui.css" rel="stylesheet" />
    <style type="text/css" media="all">
      .layui-form-label {
        width: 100px;
      }
      .layui-layout {
        margin-top: 10px;
      }
      .sidebar-header {
        height: 70px;
      }
      .sidebar-header a {
        font-size: 30px;
        color: #fff;
        line-height: 68px;
      }
    </style>
    <style>
      .layui-btn.layui-btn-sm.layui-btn-danger {
        display: none;
      }
      @media (max-width: 600px) {
        .card-body:has(.layui-form-item) {
          display: none;
        }
      }
    </style>
    <script type="text/javascript">
      function googleTranslateElementInit() {
        new google.translate.TranslateElement(
          {
            pageLanguage: "vi",
            includedLanguages: "en,zh-CN,vi",
            layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
            autoDisplay: false,
          },
          "google_translate_element"
        );
      }
    </script>
    <script type="text/javascript" src="{% static 'js/element.js' %}"></script>
    <link type="text/css" rel="stylesheet" charset="UTF-8" href="../static/m=el_main_css" />
    <script type="text/javascript" charset="UTF-8" src="../static/m=el_main"></script>
    <style type="text/css">
      /* Chart.js */
      @-webkit-keyframes chartjs-render-animation {
        from {
          opacity: 0.99;
        }
        to {
          opacity: 1;
        }
      }
      @keyframes chartjs-render-animation {
        from {
          opacity: 0.99;
        }
        to {
          opacity: 1;
        }
      }
      .chartjs-render-monitor {
        -webkit-animation: chartjs-render-animation 0.001s;
        animation: chartjs-render-animation 0.001s;
      }
    </style>
  </head>

  <body data-logobg="color_8" data-sidebarbg="color_8" style="position: relative; min-height: 100%; top: 0px">
    <div class="layout-web">
      <div class="layout-container">
        {% include "includes/sidebar.html" %}
        <!--End 左侧导航-->
        <!--Header信息-->
        {% include "includes/header.html" %}
        <!--End Header信息-->
        <!--页面主要内容-->
        <main class="layout-content">
          <div class="container-fluid">
            <div class="row">
              <div class="col-lg-12">
                <div class="card">
                  <div class="card-body">
                    <form class="layui-form" action="https://server.thienduongtop.online/admin/member/index">
                      <div class="layui-form-item">
                        <div class="layui-inline">
                          <label class="layui-form-label">Tên thành viên</label>
                          <div class="layui-input-inline">
                            <input type="text" name="username" placeholder="Nhập từ khóa tìm kiếm" autocomplete="off" class="layui-input" />
                          </div>

                          <label class="layui-form-label">IP</label>
                          <div class="layui-input-inline">
                            <input type="text" name="ip" placeholder="Vui lòng nhập IP" autocomplete="off" class="layui-input" />
                          </div>
                          <label class="layui-form-label">Trạng thái</label>
                          <div class="layui-input-inline">
                            <select name="status">
                              <option value="">Vui lòng chọn</option>
                              <option value="1">Đã bật</option>
                              <option value="0">Đã tắt</option>
                            </select>
                            <div class="layui-unselect layui-form-select">
                              <div class="layui-select-title"><input type="text" placeholder="Vui lòng chọn" value="" readonly="" class="layui-input layui-unselect" /><i class="layui-edge"></i></div>
                              <dl class="layui-anim layui-anim-upbit">
                                <dd lay-value="" class="layui-select-tips">Vui lòng chọn</dd>
                                <dd lay-value="1" class="">Đã bật</dd>
                                <dd lay-value="0" class="">Đã tắt</dd>
                              </dl>
                            </div>
                          </div>
                          <div class="layui-inline">
                            <label class="layui-form-label">Thuộc cấp dưới</label>
                            <div class="layui-input-inline">
                              <select name="uid">
                                <option value="">Vui lòng chọn</option>
                                <option value="1">admin</option>
                                <option value="2">13000000000</option>
                                <option value="3">john520</option>
                                <option value="5">ajie</option>
                                <option value="6">conmeo99</option>
                                <option value="8">adaa</option>
                                <option value="9">admins</option>
                                <option value="10">ada8386</option>
                                <option value="11">tẽ123</option>
                                <option value="13">炸塔</option>
                                <option value="14">阿美</option>
                                <option value="15">阿超</option>
                                <option value="16">阿土</option>
                                <option value="17">阿管</option>
                                <option value="18">阿峰</option>
                                <option value="22">榴莲</option>
                                <option value="23">阿合</option>
                                <option value="24">关羽</option>
                                <option value="26">国武</option>
                                <option value="27">阿龙</option>
                                <option value="29">achao</option>
                              </select>
                              <div class="layui-unselect layui-form-select">
                                <div class="layui-select-title"><input type="text" placeholder="Vui lòng chọn" value="" readonly="" class="layui-input layui-unselect" /><i class="layui-edge"></i></div>
                                <dl class="layui-anim layui-anim-upbit">
                                  <dd lay-value="" class="layui-select-tips">Vui lòng chọn</dd>
                                  <dd lay-value="1" class="">admin</dd>
                                  <dd lay-value="2" class="">13000000000</dd>
                                  <dd lay-value="3" class="">john520</dd>
                                  <dd lay-value="5" class="">ajie</dd>
                                  <dd lay-value="6" class="">conmeo99</dd>
                                  <dd lay-value="8" class="">adaa</dd>
                                  <dd lay-value="9" class="">admins</dd>
                                  <dd lay-value="10" class="">ada8386</dd>
                                  <dd lay-value="11" class="">tẽ123</dd>
                                  <dd lay-value="13" class="">炸塔</dd>
                                  <dd lay-value="14" class="">阿美</dd>
                                  <dd lay-value="15" class="">阿超</dd>
                                  <dd lay-value="16" class="">阿土</dd>
                                  <dd lay-value="17" class="">阿管</dd>
                                  <dd lay-value="18" class="">阿峰</dd>
                                  <dd lay-value="22" class="">榴莲</dd>
                                  <dd lay-value="23" class="">阿合</dd>
                                  <dd lay-value="24" class="">关羽</dd>
                                  <dd lay-value="26" class="">国武</dd>
                                  <dd lay-value="27" class="">阿龙</dd>
                                  <dd lay-value="29" class="">achao</dd>
                                </dl>
                              </div>
                            </div>
                            <div class="layui-inline" id="time" lay-key="1" layui-laydate-id="time">
                              <label class="layui-form-label">Ngày bắt đầu</label>
                              <div class="layui-input-inline">
                                <input name="start_time" type="text" autocomplete="off" id="startDate" class="layui-input" placeholder="Ngày bắt đầu" />
                              </div>
                              <label class="layui-form-label">Ngày kết thúc</label>
                              <div class="layui-input-inline">
                                <input name="end_time" type="text" autocomplete="off" id="endDate" class="layui-input" placeholder="Ngày kết thúc" />
                              </div>
                            </div>
                          </div>
                        </div>
                        <!--<div class="layui-form-item">-->
                        <!--    <div class="layui-inline">-->
                        <!--        <label class="layui-form-label">Số điện thoại</label>-->
                        <!--        <div class="layui-input-inline">-->
                        <!--          <input type="text" name="phone" placeholder="Nhập từ khóa tìm kiếm"  autocomplete="off" class="layui-input">-->
                        <!--        </div>-->
                        <!--    </div>  -->
                        <!--</div>                    -->
                        <div class="layui-form-item">
                          <div class="layui-inline">
                            <label class="layui-form-label"></label>
                            <div class="layui-input-inline">
                              <input class="layui-btn layui-btn-search" type="button" lay-submit="" lay-filter="submitSearch" value="Tìm kiếm" />
                              <button type="reset" class="layui-btn layui-btn-primary layui-border-orange">Reset</button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>

                <div class="col-lg-12">
                  <div class="card">
                    <div class="card-body">
                      <table style="height: 125px" width="640" cellspacing="0" cellpadding="2" class="layui-hide" id="table" lay-filter="table"></table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!--<script type="text/javascript" src="/static/admin/index/js/jquery.min.js"></script>
    <script type="text/javascript" src="/static/admin/index/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/static/admin/index/js/perfect-scrollbar.min.js"></script>-->
    <script src="{% static 'js/jquery.min.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <script src="{% static 'js/perfect-scrollbar.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/main.js' %}"></script>
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/layui/2.8.4/layui.min.js"></script>-->
    <script type="text/javascript" src="{% static 'js/layui.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/Chart.js' %}"></script>

    <script type="text/html" id="toolbar">
      <div class="layui-btn-container">
        <!--<button class="layui-btn layui-btn-sm" lay-event="getCheckData">Lấy dữ liệu hàng đã chọn</button>
        <button class="layui-btn layui-btn-sm" lay-event="getCheckLength">Lấy số lượng hàng đã chọn</button>
        <button class="layui-btn layui-btn-sm" lay-event="isAll">Xác nhận tất cả đã chọn</button>-->
        <button type="button" class="layui-btn layui-btn-sm" lay-event="add"><i class="layui-icon">&#xe654;</i>Thêm</button>
        <button type="button" class="layui-btn layui-btn-sm layui-btn-danger"><i class="layui-icon">&#xe640;</i>Xóa</button>
      </div>
    </script>

    <script type="text/html" id="bar">
      <!--<a class="layui-btn layui-btn-xs" lay-event="ti">Khóa</a>-->
      <a class="layui-btn layui-btn-xs" lay-event="edit">Sửa</a>
      <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">Xóa</a>
    </script>

    <script>
      layui.use(["table", "element", "form", "layer", "laydate"], function () {
        var $ = layui.$,
          table = layui.table,
          form = layui.form,
          layer = layui.layer,
          laydate = layui.laydate;
        laydate.render({
          elem: "#time",
          //设置Ngày bắt đầu、日期日期的 input 选择器
          //数组格式为 2.6.6 开始新增，之前版本直接配置 true 或任意分割字符即可
          range: ["#startDate", "#endDate"],
        });
        function table_reload(field) {
          layer.msg("Vui lòng chờ！", { icon: 16, shade: 0.01, time: 2000000 });
          table.reload("table", {
            url: "member",
            where: {
              phone: field.phone,
              uid: field.uid,
              ip: field.ip,
              username: field.username,
              status: field.status,
              start_time: field.start_time,
              end_time: field.end_time,
            },
          });

          layer.close(layer.index);
        }
        form.on("submit(submitSearch)", function (data) {
          table_reload(data.field);
        });
        form.on("switch(state)", function (data) {
          var state = data.elem.checked ? 1 : 0;
          var id = data.elem.attributes["dataid"].nodeValue;
          var index = layer.load(0, { shade: false });
          $.ajax({
            type: "post",
            url: "/admin/member/doeditstate",
            data: { id: id, state: state },
            dataType: "json",
            success: function (data) {
              if (data.code === 200) {
                layer.msg(
                  data.msg,
                  {
                    icon: 1,
                    time: 1000, //2 giây đóng (nếu không cấu hình, mặc định là 3 giây)
                  },
                  function () {
                    layer.closeAll();
                    table.reload("table");
                  }
                );
              } else {
                layer.msg(
                  data.msg,
                  {
                    icon: 1,
                    time: 1000, //2 giây đóng (nếu không cấu hình, mặc định là 3 giây)
                  },
                  function () {
                    layer.closeAll();
                    table.reload("table");
                  }
                );
              }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
              layer.closeAll();
              if (textStatus == "timeout") {
                layer.msg(
                  "Yêu cầu đã hết thời gian chờ！",
                  {
                    icon: 2,
                    time: 1500, //2 giây đóng (nếu không cấu hình, mặc định là 3 giây)
                  },
                  function () {}
                );
              } else {
                layer.msg(
                  "Lỗi máy chủ！",
                  {
                    icon: 2,
                    time: 1500, //2 giây đóng (nếu không cấu hình, mặc định là 3 giây)
                  },
                  function () {}
                );
              }
            },
          });
        });
        table.render({
          elem: "#table",
          url: "member",
          toolbar: "#toolbar", // 开启Header工具栏，并为其绑定左侧模板
          defaultToolbar: ["filter", "exports", "print"],
          title: "Danh sách quản trị viên",
          cols: [
            [
              { field: "id", title: "ID", sort: true, width: 50 },
              { field: "username", title: "Tên đăng nhập" },
              { field: "daili", title: "Giới thiệu bởi" },
              { field: "name", title: "Tên" },
              //{field:'sex', title:'Giới tính'},
              { field: "num", title: "Số lượt rút tiền" },
              { field: "min", title: "Số tiền rút tối thiểu" },
              { field: "max", title: "Số tiền rút tối đa" },
              //{field:'header_img', title:'Ảnh',width:70,templet:function(d){return '<a class="layui-btn layui-btn-xs" lay-event="open_ico">Xem</a>';}},
              {
                title: "Trạng thái",
                templet: function (d) {
                  let checked = "";
                  if (d.status == 1) {
                    checked = "checked";
                  } else {
                    checked = " ";
                  }
                  return '<input type="checkbox" ' + checked + ' name="status" dataid = "' + d.id + '" lay-skin="switch" lay-filter="status" lay-text="Mở | Đóng">';
                },
              },
              {
                field: "money",
                title: "Số dư",
                templet: function (d) {
                  return '<a href="#" style="color:red" lay-event="add_money">' + d.money + "</a>";
                },
              },
              /*{field:'amount_code', title:'Số lượng mã',templet:function(d){return '<a href="#" style="color:red" lay-event="add_amount_code">'+d.amount_code+'</a>';}},*/
              /*{field:'area', title:'Địa chỉ'},*/
              { field: "ip", title: "IP" },
              { field: "last_time", title: "Lần cuối đăng nhập" },
              { field: "create_time", title: "Thời gian đăng ký" },
              {
                fixed: "right",
                title: "Thao tác",
                fixed: "right",
                unresize: true,
                toolbar: "#bar",
                width: 160,
              },
            ],
          ],
          page: true,
        });
        form.on("switch(status)", function (data) {
          var status = data.elem.checked ? 1 : 0;
          var id = data.elem.attributes["dataid"].nodeValue;
          var index = layer.load(0, { shade: false });
          $.ajax({
            type: "post",
            url: "/admin/member/doeditstatus",
            data: { id: id, status: status },
            dataType: "json",
            success: function (data) {
              if (data.code === 200) {
                layer.msg(
                  data.msg,
                  {
                    icon: 1,
                    time: 1000, //2 giây đóng (nếu không cấu hình, mặc định là 3 giây)
                  },
                  function () {
                    layer.closeAll();
                    table.reload("table");
                  }
                );
              } else {
                layer.msg(
                  data.msg,
                  {
                    icon: 1,
                    time: 1000, //2 giây đóng (nếu không cấu hình, mặc định là 3 giây)
                  },
                  function () {
                    layer.closeAll();
                    table.reload("table");
                  }
                );
              }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
              layer.closeAll();
              if (textStatus == "timeout") {
                layer.msg(
                  "Yêu cầu đã hết thời gian chờ！",
                  {
                    icon: 2,
                    time: 1500, //2 giây đóng (nếu không cấu hình, mặc định là 3 giây)
                  },
                  function () {
                    layer.closeAll();
                  }
                );
              } else {
                layer.msg(
                  "Lỗi máy chủ！",
                  {
                    icon: 2,
                    time: 1500, //2 giây đóng (nếu không cấu hình, mặc định là 3 giây)
                  },
                  function () {
                    layer.closeAll();
                  }
                );
              }
            },
          });
        });
        //头工具栏事件
        table.on("toolbar(table)", function (obj) {
          var checkStatus = table.checkStatus(obj.config.id);
          switch (obj.event) {
            case "getCheckData":
              var data = checkStatus.data;
              layer.alert(JSON.stringify(data));
              break;
            case "getCheckLength":
              var data = checkStatus.data;
              layer.msg("Đã chọn：" + data.length + " ô");
              break;
            case "isAll":
              layer.msg(checkStatus.isAll ? "Chọn tất cả" : "Không chọn tất cả");
              break;
            case "add":
              layer.open({
                type: 2,
                title: "Thêm Người dùng",
                shadeClose: true,
                shade: false,
                resize: true,
                maxmin: true, //开启最大化最小化按钮
                area: ["893px", "600px"],
                content: "/admin/member/operation" + "?operation=add",
              });
              break;
          }
        });

        //监听行工具事件
        table.on("tool(table)", function (obj) {
          var data = obj.data;
          if (obj.event === "del") {
            layer.confirm("Xác nhận xóa dữ liệu？", function (index) {
              $.ajax({
                type: "post",
                url: "/admin/member/dodel",
                data: { id: data.id },
                dataType: "json",
                success: function (data) {
                  if (data.code === 200) {
                    layer.msg(
                      data.msg,
                      {
                        icon: 1,
                        time: 1000, //2 giây đóng (nếu không cấu hình, mặc định là 3 giây)
                      },
                      function () {
                        obj.del();
                        layer.close(index);
                        table.reload("table");
                      }
                    );
                  } else {
                    layer.msg(data.msg);
                  }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                  layer.closeAll();
                  if (textStatus == "timeout") {
                    layer.msg(
                      "Yêu cầu đã hết thời gian chờ！",
                      {
                        icon: 2,
                        time: 1500, //2 giây đóng (nếu không cấu hình, mặc định là 3 giây)
                      },
                      function () {}
                    );
                  } else {
                    layer.msg(
                      "Lỗi máy chủ！",
                      {
                        icon: 2,
                        time: 1500, //2 giây đóng (nếu không cấu hình, mặc định là 3 giây)
                      },
                      function () {}
                    );
                  }
                },
              });
            });
          } else if (obj.event === "edit") {
            layer.open({
              type: 2,
              title: "Sửa",
              shadeClose: true,
              shade: false,
              resize: true,
              maxmin: true, //开启最大化最小化按钮
              area: ["900px", "600px"],
              content: "/admin/member/operation" + "?operation=edit&id=" + obj.data.id,
            });
          } else if (obj.event === "open_ico") {
            layer.open({
              type: 1,
              title: false,
              closeBtn: 0,
              area: ["auto"],
              skin: "layui-layer-nobg", //没有背景色
              shadeClose: true,
              content: "<img style='width:300px;height:300px' src='" + obj.data.header_img + "'>",
            });
          } else if (obj.event === "add_money") {
            layer.open({
              type: 2,
              title: "Sửa",
              shadeClose: true,
              shade: false,
              resize: true,
              maxmin: true, //开启最大化最小化按钮
              area: ["900px", "600px"],
              content: "/member/addmoney" + "?id=" + obj.data.id,
            });
          } else if (obj.event === "add_amount_code") {
            layer.open({
              type: 2,
              title: "Sửa số lượng mã",
              shadeClose: true,
              shade: false,
              resize: true,
              maxmin: true, //开启最大化最小化按钮
              area: ["900px", "600px"],
              content: "/admin/member/addamountcode" + "?id=" + obj.data.id,
            });
          } else if (obj.event === "ti") {
            layer.confirm("Chắc chắn khóa？", function (index) {
              $.ajax({
                type: "post",
                url: "/admin/member/doti",
                data: { id: data.id },
                dataType: "json",
                success: function (data) {
                  if (data.code === 200) {
                    layer.msg(
                      data.msg,
                      {
                        icon: 1,
                        time: 1000, //2 giây đóng (nếu không cấu hình, mặc định là 3 giây)
                      },
                      function () {
                        layer.close(index);
                        // table.reload('table');
                      }
                    );
                  } else {
                    layer.msg(data.msg);
                  }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                  layer.closeAll();
                  if (textStatus == "timeout") {
                    layer.msg(
                      "Yêu cầu đã hết thời gian chờ！",
                      {
                        icon: 2,
                        time: 1500, //2 giây đóng (nếu không cấu hình, mặc định là 3 giây)
                      },
                      function () {}
                    );
                  } else {
                    layer.msg(
                      "Lỗi máy chủ！",
                      {
                        icon: 2,
                        time: 1500, //2 giây đóng (nếu không cấu hình, mặc định là 3 giây)
                      },
                      function () {}
                    );
                  }
                },
              });
            });
          }
        });
      });
    </script>
  </body>
</html>
